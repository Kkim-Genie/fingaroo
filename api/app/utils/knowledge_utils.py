from datetime import datetime, timedelta

def make_daily_report_prompt(date_string: str, contexts: str) -> str:
    selected_date = datetime.strptime(date_string, '%Y-%m-%d').date()
    day = selected_date.weekday()
    weekdayKor = "ì›”" if day == 0 else "í™”" if day == 1 else "ìˆ˜" if day == 2 else "ëª©" if day == 3 else "ê¸ˆ" if day == 4 else "í† " if day == 5 else "ì¼" if day == 6 else "ì›”"
    
    # í•œêµ­ì–´ ë‚ ì§œ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
    korean_date = f"{selected_date.year}ë…„ {selected_date.month:02d}ì›” {selected_date.day:02d}ì¼"

    lastDate = selected_date
    if(day==0 or day==5 or day==6):
        diff_to_friday = (day - 4 + 7) % 7
        lastDate = lastDate - timedelta(days=diff_to_friday)

    prompt = f"""
    ğŸ’¡ ì—­í• : ë‹¹ì‹ ì€ ê¸ˆìœµ ì‹œì¥ì„ ë¶„ì„í•˜ëŠ” ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì œê³µëœ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê°ê´€ì ì´ê³  ëª…í™•í•œ ë°©ì‹ìœ¼ë¡œ ì¦ì‹œ ìš”ì•½ì„ ì‘ì„±í•˜ì„¸ìš”.

    ğŸ“Œ **ì¦ì‹œ ìš”ì•½**
    ë‹¤ìŒì˜ ë°ì´í„°ë¥¼ í™œìš©í•˜ì—¬ "Fingoo ì¦ì‹œ ìš”ì•½"ì„ ì‘ì„±í•˜ì„¸ìš”. ì œê³µëœ ë°ì´í„°ëŠ” ë¯¸êµ­ ì¦ì‹œ ê´€ë ¨ ë‰´ìŠ¤ ë° ë¶„ì„ ìë£Œì…ë‹ˆë‹¤.

    ### ğŸ”¥ **ë³´ê³ ì„œ ì‘ì„± í…œí”Œë¦¿**:
    ã€Fingoo ì¦ì‹œ ìš”ì•½ ï½œ{korean_date} ({weekdayKor}ìš”ì¼)ã€‘ 

    ğŸ“Œ **1. í•µì‹¬ ìš”ì ** ( ~ {date_string} ê¸°ì¤€)
    - ì£¼ìš” ì¦ì‹œ ë³€ë™ ì‚¬í•­ (ì§€ìˆ˜ ìƒìŠ¹/í•˜ë½, ì£¼ìš” ì›ì¸)ì„ í•œ ë¬¸ì¥ìœ¼ë¡œ ìš”ì•½í•˜ì—¬ ê°œì¡°ì‹ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”.
    - ì‹œì¥ ì°¸ì—¬ìë“¤ì˜ ë°˜ì‘ì„ í•œ ì¤„ì”© ì •ë¦¬í•˜ì„¸ìš”.
    - ì‹œì¥ì— ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆëŠ” ì£¼ìš” ì¸ë¬¼ì˜ ë°œì–¸ ë° ê´€ë ¨ ë‰´ìŠ¤ë¥¼ í¬í•¨í•˜ì„¸ìš”.

    ğŸ“Œ **2. ì¦ì‹œ ë§ˆê° ìš”ì•½** ( ~ {lastDate} ê¸°ì¤€)
    - ì£¼ìš” ì§€ìˆ˜ ë§ˆê° ìˆ˜ì¹˜ ë° ë³€ë™ë¥  (S&P500, ë‚˜ìŠ¤ë‹¥100, ë‹¤ìš°, ëŸ¬ì…€2000 ë“±)
    - í•´ë‹¹ ë³€ë™ì— ëŒ€í•œ ì‹¤ì œ ìš”ì¸ ì„¤ëª…

    ğŸ“Œ **3. ê²½ì œ ë°ì´í„° & ì‹œì¥ ë°˜ì‘** ( ~ {date_string} ê¸°ì¤€)
    - ë¯¸êµ­ ê²½ì œ ë°ì´í„° ë°œí‘œ ë‚´ìš© ë° ì‹œì¥ ë°˜ì‘ (êµ­ì±„ ìˆ˜ìµë¥ , ì™¸í™˜, ê¸ˆ, ì›ìœ  ë“± í¬í•¨)
    - ì „ë¬¸ê°€ì˜ ë°˜ì‘ (ê¸°ê´€, ì´ë¦„, ì½”ë©˜íŠ¸ í¬í•¨)

    ğŸ“Œ **4. ê°œë³„ ê¸°ì—… ë‰´ìŠ¤** ( ~ {lastDate} ê¸°ì¤€)
    - ì£¼ê°€ ë³€ë™ì´ ìˆì—ˆë˜ ê¸°ì—…, ì£¼ìš” ì´ìŠˆ ë° ë°œì–¸ í¬í•¨

    ğŸ“Œ **5. ê¸ˆì¼ ì£¼ìš” ì¼ì •** ( ~ {date_string} ê¸°ì¤€)
    - â˜…â˜…â˜… ì´ìƒ ì¼ì •ë§Œ ì¶”ì¶œí•˜ì—¬ ì •ë¦¬

    âš  ê°€ì¥ ì²˜ìŒì— ì™€ì•¼ í•  ê¸€ìëŠ” "ã€Fingoo ì¦ì‹œ ìš”ì•½ ï½œ{korean_date} ({weekdayKor}ìš”ì¼)ã€‘" ì´ì–´ì•¼ í•©ë‹ˆë‹¤.
    âš  ë°˜ë“œì‹œ ì£¼ì–´ì§„ ë°ì´í„°ë§Œì„ ì‚¬ìš©í•˜ì—¬ ì‘ì„±í•˜ì„¸ìš”. ì¶”ê°€ì ì¸ ê°€ì •ì´ë‚˜ ì°½ì‘ì€ í•˜ì§€ ë§ˆì„¸ìš”.  
    âš  ì •ë³´ì˜ ì¶œì²˜ë¥¼ ì ˆëŒ€ ê¸°ì…í•˜ì§€ ë§ˆì„¸ìš”.  

    âš  ë³¸ Fingoo ì¦ì‹œ ë ˆí¬íŠ¸ëŠ” ê³µì‹ ë ¥ ìˆëŠ” ìë£Œë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ì—¬ Fingoo ì¸ê³µì§€ëŠ¥(AI) ê¸°ìˆ ì„ ì‚¬ìš©í•˜ì—¬ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤."ë¥¼ ë§ˆì§€ë§‰ì— ì¶œë ¥í•´ì¤˜.

    contexts : 
    {contexts}

    """

    return prompt

def make_weekly_report_prompt(end_date:str, news_contexts:str, market_contexts:str) -> str:
    start_date = datetime.strptime(end_date, '%Y-%m-%d').date() - timedelta(days=6)
    prompt = f"""
    ì—­í• : ë‹¹ì‹ ì€ ê¸ˆìœµ ì‹œì¥ì„ ë¶„ì„í•˜ëŠ” ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì œê³µëœ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê°ê´€ì ì´ê³  ëª…í™•í•œ ë°©ì‹ìœ¼ë¡œ ì£¼ê°„ ì¦ì‹œ ìš”ì•½ì„ ì‘ì„±í•˜ì„¸ìš”.

    ğŸ“Œ **ì£¼ê°„ ì¦ì‹œ ìš”ì•½**
    ë‹¤ìŒì˜ ë°ì´í„°ë¥¼ í™œìš©í•˜ì—¬ "Fingoo ì£¼ê°„ ì¦ì‹œ ìš”ì•½"ì„ ì‘ì„±í•˜ì„¸ìš”. ì œê³µëœ ë°ì´í„°ëŠ” {start_date} ~ {end_date} ê¸°ê°„ ë™ì•ˆì˜ ë¯¸êµ­ ì¦ì‹œ ê´€ë ¨ ë‰´ìŠ¤ ë° ë¶„ì„ ìë£Œì…ë‹ˆë‹¤.

    ğŸ“Œ **ë³´ê³ ì„œ ê¸°ê°„**: {start_date} ~ {end_date}

    ...

    âš  **ë°˜ë“œì‹œ ì£¼ì–´ì§„ ë°ì´í„°ë§Œì„ ì‚¬ìš©í•˜ì—¬ ì‘ì„±í•˜ì„¸ìš”. ì¶”ê°€ì ì¸ ê°€ì •ì´ë‚˜ ì°½ì‘ì€ í•˜ì§€ ë§ˆì„¸ìš”.**  
    âš  **ì •ë³´ì˜ ì •í™•ì„±ì„ ìœ ì§€í•˜ë©°, ì§€ë‚˜ì¹˜ê²Œ ê·¹ì ì¸ í‘œí˜„ì€ í”¼í•˜ì„¸ìš”.**  
    âš  **ì •ë³´ì˜ ì¶œì²˜ë¥¼ ì ˆëŒ€ ê¸°ì…í•˜ì§€ ë§ˆì„¸ìš”.**  

    " âš  ë³¸ Fingoo ì£¼ê°„ ì¦ì‹œ ë ˆí¬íŠ¸ëŠ” ê³µì‹ ë ¥ ìˆëŠ” ìë£Œë¥¼ ê¸°ë°˜ìœ¼ë¡œ Fingoo AI ê¸°ìˆ ì„ ì‚¬ìš©í•˜ì—¬ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤."ë¥¼ ë§ˆì§€ë§‰ì— ì¶œë ¥í•´ ì£¼ì„¸ìš”.

    ìœ„ í¬ë©§ì— ë§ì¶°ì„œ {start_date} ~ {end_date} ê¸°ê°„ì˜ ì•„ë˜ 'context' ë°ì´í„°ë¥¼ ì°¸ê³ í•˜ì—¬ ì£¼ê°„ ì‹œí™©ì„ ì‘ì„±í•˜ì„¸ìš”.
    ì‹œí™© ë°ì´í„° context: {market_contexts}
    ë‰´ìŠ¤ context: {news_contexts}
    """

    return prompt


def make_weekly_report_dates(end_date:str) -> list[str]:
    end_date_obj = datetime.strptime(end_date, '%Y-%m-%d').date()
    current_date = end_date_obj - timedelta(days=6)

    datesToFetch = []

    while(current_date <= end_date_obj):
        datesToFetch.append(current_date.isoformat())
        current_date += timedelta(days=1)

    return datesToFetch